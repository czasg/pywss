---
title: å¿«é€Ÿä¸Šæ‰‹
hide_title: true
hide_table_of_contents: false
slug: /start
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

export const Highlight = ({children}) => (
  <span
    style={{
      backgroundColor: '#f1f0d8',
      borderRadius: '10px',
      color: '#000',
      padding: '0.4rem',
      fontWeight: 700,
    }}>
    {children}
  </span>
);

## å®‰è£…
Pywss ä¾èµ– python 3.6+ ç‰ˆæœ¬çš„éƒ¨åˆ†ç‰¹æ€§ã€‚

å¦‚æœä½ åˆšå¥½ä½¿ç”¨çš„æ˜¯ 3.6 åŠä»¥ä¸Šç‰ˆæœ¬çš„è¯ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¯ä»¥é€šè¿‡`pip`å®ç°å¿«é€Ÿå®‰è£…ã€‚

<Tabs className="unique-tabs">
<TabItem value="pipå®‰è£…" label="pipå®‰è£…" default>

```shell
>>> pip3 install pywss
>>> pip3 install pywss -i https://pypi.org/simple
>>> pip3 install pywss -i https://pypi.tuna.tsinghua.edu.cn/simple
```

</TabItem>
<TabItem value="æºç å®‰è£…" label="æºç å®‰è£…" default>

```shell
>>> git clone https://github.com/czasg/pywss.git
>>> cd pywss
>>> python3 setup.py install
```

</TabItem>
</Tabs>

Pywss ç›®å‰ä»…ä¾èµ–ä¸€ä¸ªæ—¥å¿—åº“ [loggus](https://github.com/czasg/loggus)ï¼Œè¯¥åº“æ˜¯ä½œè€…å¯¹ç»“æ„åŒ–æ—¥å¿—åº“çš„æ¢ç´¢æˆæœï¼Œæš‚æ—¶å¤Ÿç”¨ğŸ˜…ã€‚

åç»­ä¼šè€ƒè™‘åˆ‡å›åŸç”Ÿæ—¥å¿—åº“ loggingï¼Œå‡å°‘å¿ƒæ™ºè´Ÿæ‹…ğŸ˜…ã€‚


## åˆ›å»ºåº”ç”¨
æœ¬èŠ‚ç»§ç»­ä»¥ hello world ä¸ºä¾‹ï¼Œä»é›¶å¼€å§‹å¿«é€Ÿæ­å»ºä¸€ä¸ª web åº”ç”¨ã€‚

é¦–å…ˆï¼Œåœ¨æœ¬åœ°åˆ›å»º **main.py** æ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹æºç ã€‚

<Tabs className="unique-tabs">
  <TabItem value="main.py" label="main.py" default>

```python showLineNumbers title="æºç "
import pywss

def helloHandler(ctx: pywss.Context):
    ctx.write({"hello": "world"})

def main(defaultPort = 8080):
    app = pywss.App()
    app.get("/hi", lambda ctx: ctx.write("hi~"))  # åŒ¿åå‡½æ•°ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©
    app.post("/hello", helloHandler)
    app.run(port=defaultPort)

if __name__ == '__main__':
    """
    python3 main.py å¯åŠ¨æœåŠ¡
    """
    main()
```

  </TabItem>
  <TabItem value="GET/hi" label="GET/hi">

```shell title="è¯·æ±‚ /hi æ¥å£"
>>> curl localhost:8080/hi
hi~
```

  </TabItem>
  <TabItem value="POST/hello" label="POST/hello">

```shell title="è¯·æ±‚ /hello æ¥å£"
>>> curl -X POST localhost:8080/hello
{"hello": "world"}
```

  </TabItem>
</Tabs>

åœ¨ **`main.py`** ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š

#### 1.é¦–å…ˆæ˜¯åˆå§‹åŒ–æ¨¡å—

- åœ¨ç¬¬7è¡Œåˆå§‹åŒ–äº†ä¸€ä¸ª`app`ã€‚
- åœ¨ç¬¬10è¡Œæ‰§è¡Œ`app.run`å¯åŠ¨ web åº”ç”¨ã€‚

è¿™ä¸¤è¡Œä»£ç ï¼Œå›Šæ‹¬äº† app ä» **åˆå§‹åŒ– -> å¯åŠ¨** çš„æ•´ä¸ªå‘¨æœŸã€‚

#### 2.å…¶æ¬¡æ˜¯è·¯ç”±æ³¨å†Œæ¨¡å—

- ç¬¬8è¡Œ **`app.get()`** è¡¨ç¤º **æ³¨å†Œ Http Get** æ–¹æ³•ï¼Œå…¶å‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š
    - **ç»‘å®šè·¯ç”±** `/hi`
    - **ç»‘å®šä¸šåŠ¡å¤„ç†é€»è¾‘** `lambda ctx: ctx.write("hi~")`
- ç¬¬9è¡Œ **`app.post()`** è¡¨ç¤º **æ³¨å†Œ Http Post** æ–¹æ³•ï¼Œå…¶å‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š
    - **ç»‘å®šè·¯ç”±** `/hello`
    - **ç»‘å®šä¸šåŠ¡å¤„ç†é€»è¾‘** `helloHandler`

é€šè¿‡ `python3 main.py` å¯åŠ¨æœåŠ¡åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `curl` æ¥éªŒè¯æœåŠ¡ã€‚ç»“æœè§ä¸Šã€‚

è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ hello world åº”ç”¨å°±æ­å»ºå®Œæˆäº†ã€‚



## ä¸Šä¸‹æ–‡ **Context**
åœ¨ Pywss ä¸­ï¼Œ**`pywss.Context`**ï¼ˆåæ–‡å‡ä½¿ç”¨ ctx ä»£æ›¿ï¼‰ **è´¯ç©¿äºå•æ¬¡è¯·æ±‚çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ**ï¼Œæ˜¯ Pywss ç”¨äºç®¡ç†è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚

å¯¹äº Pywss çš„ **Handler**ï¼ˆä¸šåŠ¡é€»è¾‘å¤„ç†æ¨¡å—ï¼‰ æ¥è¯´ï¼Œä»…ä¸”æ”¯æŒ **ctx** è¿™ä¸€ä¸ªå‚æ•°ã€‚

æ‰€ä»¥ï¼Œ**ctx** æ˜¯ä¸€ä¸ªé›† **HTTP è¯·æ±‚æŠ¥æ–‡è§£æã€HTTP å“åº”æŠ¥æ–‡æ„å»ºã€ä¿¡æ¯ä¼ é€’** äºä¸€ä½“çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚

å…¶ä¸»è¦å±æ€§æœ‰ï¼š

|å±æ€§|ç±»å‹|è¯´æ˜|
|---|---|---|
|**`ctx.app`**|`pywss.App`|æ ¹ **app** å¯¹è±¡|
|**`ctx.fd`**|`socket.socket`|sockå¥æŸ„ï¼Œç”¨äº**å†™æ“ä½œ**ï¼Œä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨|
|**`ctx.rfd`**|`socket.makefile`|sockå¥æŸ„ï¼Œç”¨äº**è¯»æ“ä½œ**ï¼Œä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨|
|**`ctx.address`**|`tuple`|**HTTPåœ°å€ä¿¡æ¯**|
|**`ctx.method`**|`str`|**HTTPè¯·æ±‚æ–¹æ³•**ï¼Œç”± GET/POST/PUT/DELETE/HEAD/PATCH/OPTIONS ç»„æˆ|
|**`ctx.version`**|`str`|**HTTPåè®®ç‰ˆæœ¬å·**ï¼Œå‚è€ƒå€¼ï¼š`HTTP/1.1`|
|**`ctx.url`**|`str`|**HTTPè¯·æ±‚URLåœ°å€**ï¼Œæ³¨æ„æ˜¯**åŒ…å«è¯·æ±‚å‚æ•°åœ¨å†…**çš„å…¨é‡åœ°å€ã€‚å‚è€ƒå€¼ï¼š`/api/v1/query?key=value`|
|**`ctx.url_params`**|`dict`|**HTTPè¯·æ±‚å‚æ•°**ï¼Œæ˜¯åŸºäº`ctx.url`è§£æçš„ç»“æœã€‚ä¸¾ä¾‹è¯´æ˜ï¼šå¯¹äº`/api/v1/query?key=value`åœ°å€ï¼Œ`ctx.url_params`ç­‰äº**`{"key": "value"}`**|
|**`ctx.route`**|`str`|**HTTPè¯·æ±‚è·¯ç”±**ï¼Œæ³¨æ„æ˜¯**ä¸åŒ…å«è¯·æ±‚å‚æ•°åœ¨å†…**çš„è·¯ç”±ï¼Œå‚è€ƒï¼š`/api/v1/query`|
|**`ctx.route_params`**|`dict`|ç”¨äºå­˜å‚¨[å±€éƒ¨åŒ¹é…](advance/route-match)ä¸‹çš„è·¯å¾„å‚æ•°ï¼Œä¸¾ä¾‹è¯´æ˜ï¼šå¯¹äº`/api/v1/{name}/{age}`è·¯ç”±ï¼Œ`ctx.route_params`ç­‰äº**`{"name": "xx", "age": "xx"}`**|
|**`ctx.headers`**|`dict`|**HTTPè¯·æ±‚å¤´**|
|**`ctx.cookies`**|`dict`|**HTTPè¯·æ±‚Cookie**ï¼Œæ˜¯åŸºäº`ctx.headers["Cookie"]`è§£æçš„ç»“æœ|
|**`ctx.content_length`**|`int`|**HTTPè¯·æ±‚å¤§å°**ï¼Œæ˜¯åŸºäº`ctx.headers["Content-Length"]`è§£æçš„ç»“æœ|
|**`ctx.content`**|`byte`|**HTTPè¯·æ±‚æ•°æ®ä½“**ã€‚ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼Œå¯¹äºéœ€è¦è·å–åŸç”Ÿè¯·æ±‚åœºæ™¯ï¼Œ**æ¨èä½¿ç”¨`ctx.body()`**|
|**`ctx.data`**|`pywss.Data`|åŸºäºå­—å…¸å®ç°ï¼Œ**ç”¨äºContextä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’**ã€‚ä½¿ç”¨æ–¹å¼å‚è€ƒ `ctx.data.key = value`|
|**`ctx.body()`**|`func`|[**è§£æè¯·æ±‚**](advance/request-parse#byte)ï¼Œä»¥ **BYTE** å½¢å¼è¿”å›|
|**`ctx.json()`**|`func`|[**è§£æè¯·æ±‚**](advance/request-parse#json)ï¼Œä»¥ **JSON** å½¢å¼è¿”å›|
|**`ctx.form()`**|`func`|[**è§£æè¯·æ±‚**](advance/request-parse#form)ï¼Œä»¥ **FORM** å½¢å¼è¿”å›|
|**`ctx.file()`**|`func`|[**è§£æè¯·æ±‚**](advance/request-parse#file)ï¼Œä»¥ **`Dict[str, pywss.File]`** å½¢å¼è¿”å›|
|**`ctx.stream()`**|`func`|[**æµå¼è¯»å–è¯·æ±‚**](advance/request-parse#stream)ï¼Œç”¨äºæŸäº›å¤§æ•°æ®åœºæ™¯|
|**`ctx.set_status_code()`**|`func`|æŒ‡å®šHTTPå“åº”æŠ¥æ–‡**çŠ¶æ€ç **|
|**`ctx.set_header()`**|`func`|æŒ‡å®šHTTP**å“åº”å¤´**|
|**`ctx.set_content_type()`**|`func`|æŒ‡å®šHTTP**å“åº”ç±»å‹**|
|**`ctx.set_cookie()`**|`func`|æŒ‡å®šHTTP**å“åº”Cookie**|
|**`ctx.write()`**|`func`|æŒ‡å®šHTTP**å“åº”ä½“**ï¼Œæ”¯æŒ **Stringã€JSONã€Chunked** ç­‰ï¼Œè¯¦æƒ…è§[å“åº”æ¨¡å—](advance/response)|
|**`ctx.flush()`**|`func`|**å‘é€HTTPå“åº”æŠ¥æ–‡**ï¼Œä¸€èˆ¬ä¸éœ€è¦è‡ªå·±è°ƒç”¨ã€‚`flush`ä»…ä¸”åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨ä»…ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆ~|


## ä¼˜é›…çš„ä½¿ç”¨ **Next**

:::caution å‰æè¯´æ˜

æœ¬èŠ‚æºä»£ç å–è‡ª **v0.1.18** ç‰ˆæœ¬ï¼Œæœ€æ–°ä»£ç è¯·å‚è€ƒ [Github-Pywss](https://github.com/czasg/pywss)

:::

### åŸç†ç®€ä»‹

**`ctx.next`** æœ¬è´¨æ˜¯ä¸€ä¸ª**åµŒå¥—è°ƒç”¨**ã€‚

```python showLineNumbers title="ç¤ºä¾‹"
# å®šä¹‰å¤šä¸ªhandler
handler_1 = lambda ctx: ctx.next()  # è§¦å‘handler_2
handler_2 = lambda ctx: ctx.next()  # è§¦å‘handler_3
handler_3 = lambda ctx: ctx.next()  # æ— æ•ˆ

# æ³¨å†Œå¤šä¸ªhandler
app.get("/hello", handler_1, handler_2, handler_3)

# é€šè¿‡nextåµŒå¥—è°ƒç”¨å®ç°åŒç­‰æ›¿æ¢çš„æ•ˆæœ
ctx.next() -> handler_1(ctx)  # ç¬¬ä¸€æ¬¡è°ƒç”¨ç­‰åŒäºhandler_1(ctx)
ctx.next() -> handler_2(ctx)  # ç¬¬äºŒæ¬¡è°ƒç”¨ç­‰åŒäºhandler_2(ctx)
ctx.next() -> handler_3(ctx)  # ç¬¬ä¸‰æ¬¡è°ƒç”¨ç­‰åŒäºhandler_3(ctx)
ctx.next() -> None            # ç¬¬å››æ¬¡è°ƒç”¨ï¼Œæ— æ•ˆ
```

å…¶æºç ä¹Ÿæ˜¯éå¸¸çš„ç®€æ´ï¼Œæ ¸å¿ƒé€»è¾‘ä»…ç”±å‡ è¡Œä»£ç å®ç°ï¼š

```python showLineNumbers title="ctx.next æºç "
def next(self) -> None:
    if self._handler_index >= len(self._handlers):
        return
    index = self._handler_index
    self._handler_index += 1
    self._handlers[index](self)
```

å…·ä½“å®ç°æµç¨‹æ­¤å¤„ä¸å±•å¼€ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç›´æ¥é˜…è¯»[æºç ](https://github.com/czasg/pywss)ã€‚


### ä½¿ç”¨æ–¹æ³•

åŸºäº **`ctx.next`** åµŒå¥—è°ƒç”¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é¡ºåºçš„é€‰æ‹© **æ‰§è¡Œ/ä¸æ‰§è¡Œ** åé¢çš„handlerï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“çš„å®ç°**ä¸­é—´ä»¶æ‹“å±•**ã€‚

åœ¨ pywss ä¸­ï¼Œæä¾›äº†ä¸¤ç§æ–¹å¼æ¥æ‹“å±•ä¸­é—´ä»¶èƒ½åŠ›ï¼š

- **app use å…¨å±€æ³¨å†Œ** ï¼Œé’ˆå¯¹å…¨éƒ¨è·¯ç”±ç”Ÿæ•ˆ
- **route bind å±€éƒ¨æ³¨å†Œ** ï¼Œé’ˆå¯¹æŒ‡å®šè·¯ç”±ç”Ÿæ•ˆ

ä¸‹é¢é€šè¿‡ä¸€ä¸ª`logHandler`æ¥å®æˆ˜æ¼”ç¤ºä¸‹å¦‚ä½•é€šè¿‡`next`å¿«é€Ÿå®ç°ä¸€ä¸ªæ—¥å¿—ä¸­é—´ä»¶~

```python title="å…¨å±€æ³¨å†Œ" showLineNumbers {7,12}
import pywss
import time
import random

def logHandler(ctx: pywss.Context):
    startTime = time.time()
    ctx.next()
    cost = time.time() - startTime
    print(f"{ctx.method} - {ctx.route} - cost: {cost: .2f}")

app = pywss.App()
app.use(logHandler)
app.get("/hi", lambda ctx: time.sleep(random.randint(1, 3)) or ctx.write("Hi~"))
app.post("/hello", lambda ctx: time.sleep(random.randint(1, 3)) or ctx.write("HelloWorld"))
app.run()
```

```python title="å±€éƒ¨æ³¨å†Œ" showLineNumbers {7,13}
import pywss
import time
import random

def logHandler(ctx: pywss.Context):
    startTime = time.time()
    ctx.next()
    cost = time.time() - startTime
    print(f"{ctx.method} - {ctx.route} - cost: {cost: .2f}")

app = pywss.App()
app.get("/hi", lambda ctx: time.sleep(random.randint(1, 3)) or ctx.write("Hi~"))
app.post("/hello", logHandler, lambda ctx: time.sleep(random.randint(1, 3)) or ctx.write("HelloWorld"))
app.run()
```
